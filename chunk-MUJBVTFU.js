import{a as s,j as l,k as n,o as u,p as d,q as c}from"./chunk-6F3JZZEN.js";import{D as i,Db as h,z as a}from"./chunk-QGRJSNEC.js";var v=(()=>{let r=class r extends c{get thumb(){return!this.user.thumb||this.user.thumb.includes("assets/default.png")?"assets/default.png":this.url+this.user.thumb}constructor(){super({name:"user",replace:e=>{e.roles=[],e.data=e.data||{};for(let t of s.userFields||[])e.data[t]=e.data[t]||{};for(let t of this.roles)e.is[t]&&e.roles.push(t);return e}}),this._http=i(d),this._store=i(u),this._alert=i(l),this._core=i(n),this._router=i(h),this.url=s.url,this.roles=(s.roles||[]).concat(["admin"]),this.employees=s.roles||[],this.mode="dark",this.modes=(s.modes||[]).concat(["dark","white"]),this.users=this.getDocs(),this.user=localStorage.getItem("waw_user")?JSON.parse(localStorage.getItem("waw_user")):this.new(),this.usersByRole={},this._changingPassword=!1,this.filteredDocuments(this.usersByRole,"roles"),this.fetch({},{name:"me"}).subscribe(e=>{e?(!localStorage.getItem("waw_user")&&this._router.url==="/sign"&&this._router.navigateByUrl("/profile"),this.setUser(e)):localStorage.getItem("waw_user")&&this.logout()}),this.get({query:s.appId?"appId="+s.appId:""}),this._store.get("mode",e=>{e?this.setMode(e):this.setMode("dark")})}setMode(e="white"){if(e==="white"){this._store.remove("mode");for(let t of this.modes)document.body.parentNode.classList.remove(t)}else this._store.set("mode",e),document.body.parentNode.classList.add(e);this.mode=e}setUser(e){this.user=e,localStorage.setItem("waw_user",JSON.stringify(e)),this._core.complete("us.user")}role(e){return!!(this.user?.is||{})[e]}updateMe(){this.setUser(this.user),this.update(this.user)}updateMeAfterWhile(){this.setUser(this.user),this.updateAfterWhile(this.user)}changePassword(e,t){this._changingPassword||(this._changingPassword=!0,this._http.post("/api/user/changePassword",{newPass:t,oldPass:e},m=>{this._changingPassword=!1,m?this._alert.info({text:"Successfully changed password"}):this._alert.error({text:"Incorrect current password"})}))}logout(){this.user=this.new(),localStorage.removeItem("waw_user"),this._http.remove("token"),this._http.get("/api/user/logout"),this._router.navigateByUrl("/sign"),setTimeout(()=>{location.reload()},100)}updateAdmin(e){this.update(e,{name:"admin"})}deleteAdmin(e){this.delete(e,{name:"admin"})}};r.\u0275fac=function(t){return new(t||r)},r.\u0275prov=a({token:r,factory:r.\u0275fac,providedIn:"root"});let o=r;return o})();export{v as a};
