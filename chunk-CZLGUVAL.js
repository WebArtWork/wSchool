import{a as ot}from"./chunk-2H4XP5XP.js";import{a as D,k as b,o as Z,p as tt,q as et,s as nt}from"./chunk-6F3JZZEN.js";import{$ as C,Aa as W,D as m,F as d,G as u,Ha as K,Ia as x,J as q,Ja as j,Ka as L,La as U,Sa as H,Ta as Y,U as h,W as R,a as V,ab as G,b as A,bb as T,ea as J,fa as w,ia as N,ib as Q,ka as y,la as F,ma as S,mb as X,na as k,oa as I,pa as f,qa as l,ra as p,va as z,wa as v,xa as _,ya as a,z as P,za as B}from"./chunk-QGRJSNEC.js";var at=["*"],it=(()=>{let o=class o{constructor(){this.type=T("primary"),this.class=T(""),this.disabled=T(!1),this.disableSubmit=T(!1),this.click=T(void 0),this.wClick=G()}clicked(){this.disabled()||(typeof this.click()=="function"&&this.click()?.(),this.wClick.emit())}};o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=C({type:o,selectors:[["wbutton"]],inputs:{type:[1,"type"],class:[1,"class"],disabled:[1,"disabled"],disableSubmit:[1,"disableSubmit"],click:[1,"click"]},outputs:{wClick:"wClick"},ngContentSelectors:at,decls:2,vars:22,consts:[[3,"click","type","disabled"]],template:function(e,n){e&1&&(B(),l(0,"button",0),_("click",function(){return n.clicked()}),W(1),p()),e&2&&(x("w-btn"+(n.class()?" "+n.class():"")),K("_secondary",n.type()==="secondary")("_primary",n.type()==="primary")("_success",n.type()==="success")("_warning",n.type()==="warning")("_danger",n.type()==="danger")("_light",n.type()==="light")("_info",n.type()==="info")("_dark",n.type()==="dark")("_link",n.type()==="link"),f("type",n.click()||n.disableSubmit()?"button":"submit")("disabled",n.disabled()))},encapsulation:2});let i=o;return i})();function lt(i,o){if(i&1){let r=v();l(0,"wbutton",4),_("click",function(){let e=d(r).$implicit,n=a();return u(e.click(n.submition,n.close))}),j(1),p()}if(i&2){let r=o.$implicit;f("ngClass",r.class),h(),U(" ",r.label," ")}}var $=(()=>{let o=class o{constructor(){this._core=m(b),this.submit=t=>{},this.change=t=>{}}set(t){this._core.copy(t,this.submition),this._core.copy(t.data,this.submition.data)}};o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=C({type:o,selectors:[["ng-component"]],decls:5,vars:2,consts:[["formRef",""],[3,"wSubmit","wChange","config","submition"],[1,"btn-action","btn-action_w95p"],[1,"w-btn","_primary",3,"ngClass"],[1,"w-btn","_primary",3,"click","ngClass"]],template:function(e,n){if(e&1){let s=v();l(0,"wform",1,0),_("wSubmit",function(){return d(s),n.set(n.submition),n.submit(n.submition),u(n.close())})("wChange",function(){return d(s),n.set(n.submition),u(n.change(n.submition))}),p(),l(2,"div",2),k(3,lt,2,2,"wbutton",3,S),p()}e&2&&(f("config",n.form)("submition",n.submition),h(3),I(n.buttons))},dependencies:[E,it,Q],styles:[".btn-action[_ngcontent-%COMP%]{padding:30px 0 0}.btn-action[_ngcontent-%COMP%]   .w-btn[_ngcontent-%COMP%]{width:100%;display:block}"]});let i=o;return i})();var st=(()=>{let o=class o{constructor(){this._http=m(tt)}get getDoc(){return this.doc}change(){this._http.post("/api/"+this.module+"/unique"+(this.field||""),this.doc).subscribe(t=>{this.doc[this.field]!==t&&(this.doc[this.field]=t)})}};o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=C({type:o,selectors:[["app-modal-unique"]],decls:1,vars:2,consts:[[3,"wChange","config","submition"]],template:function(e,n){e&1&&(l(0,"wform",0),_("wChange",function(){return n.change()}),p()),e&2&&f("config",n.form)("submition",n.getDoc)},dependencies:[E],encapsulation:2});let i=o;return i})();var rt=(()=>{let o=class o extends et{constructor(){super({name:"form"}),this._core=m(b),this.appId=D.appId,this.customforms=[],this.get({query:this.appId?"appId="+this.appId:""}).subscribe(t=>this.customforms.push(...t)),this._core.on("customform_create").subscribe(t=>{this.customforms.push(t)}),this._core.on("customform_delete").subscribe(t=>{this.customforms.splice(this.customforms.findIndex(e=>e._id===t._id),1)})}};o.\u0275fac=function(e){return new(e||o)},o.\u0275prov=P({token:o,factory:o.\u0275fac,providedIn:"root"});let i=o;return i})();var ct=(()=>{let o=class o{constructor(){this.componentFactoryResolver=m(R),this._translate=m(ot),this._cfs=m(rt),this.appRef=m(N),this._modal=m(nt),this._store=m(Z),this._core=m(b),this.injector=m(q),this.appId=D.appId,this._injectedComponent={},this.templateFields={},this.customTemplateFields={},this._templateComponent={},this.forms=[],this.formIds=[],this._store.getJson("formIds",t=>{Array.isArray(t)&&this.formIds.push(...t)})}getTemplateFields(t){return this.templateFields[t]||["Placeholder","Label"]}setTemplateFields(t,e,n={}){this.templateFields[t]=e,this.customTemplateFields[t]=V(V({},this.customTemplateFields[t]||{}),n)}getCustomTemplateFields(t){return this.customTemplateFields[t]||{}}injectComponent(t,e,n=["Placeholder","Label"],s={}){if(!this._injectedComponent[t]){this._injectedComponent[t]=!0,this.templateFields[t]=n,this.customTemplateFields[t]=s;let g=this.componentFactoryResolver.resolveComponentFactory(e).create(this.injector);this.appRef.attachView(g.hostView);let O=g.hostView.rootNodes[0];document.body.appendChild(O)}}addTemplateComponent(t,e){this._templateComponent[t]||(this._templateComponent[t]=e)}getTemplateComponent(t){return this._templateComponent[t]}getTemplateComponentsNames(){let t=[];for(let e in this._templateComponent)t.push(e);return t}translateForm(t){if(t.title){t.title=this._translate.translate(`Form_${t.formId}.${t.title}`,e=>{t.title=e});for(let e of t.components)for(let n of e.fields||[])this.translateFormComponent(t,n)}}translateFormComponent(t,e){let n=e.value;typeof n=="string"&&!e.skipTranslation&&(e.value=this._translate.translate(`Form_${t.formId}.${n}`,s=>{e.value=s}))}getDefaultForm(t,e=["name","description"]){return this.formIds.indexOf(t)===-1&&(this.formIds.push(t),this._store.setJson("formIds",this.formIds)),{id:t,components:e.map((s,c)=>({name:s.includes(".")?s.split(".")[1]:"Text",key:s,focused:!c,fields:[{name:"Placeholder",value:"Enter your "+s.split(".")[0]},{name:"Label",value:s.split(".")[0].capitalize()}]}))}}prepareForm(t){let e=t.formId+"";return this.formIds.indexOf(e)===-1&&(this.formIds.push(e),this._store.setJson("formIds",this.formIds)),t=t||this.getDefaultForm(e),t.formId=e,this._core.onComplete("form_loaded").then(()=>{let n=this._cfs.customforms.filter(s=>s.active&&s.formId===t.formId);for(let s of n){t.title=t.title||s.name,t.class=t.class||s.class;for(let c of s.components)c.key=c.key?.startsWith("data.")?c.key:"data."+c.key,t.components.push(c)}this.translateForm(t)}),t}getForm(t,e){return console.warn("This function is deprecated"),e&&this.forms.map(n=>n.formId).indexOf(e?.formId)===-1&&this.forms.push(e),this.formIds.indexOf(t)===-1&&(this.formIds.push(t),this._store.setJson("formIds",this.formIds)),e=e||this.forms.find(n=>n.formId===t),e=e||this.getDefaultForm(t),e.formId=t,this._core.onComplete("form_loaded").then(()=>{let n=this._cfs.customforms.filter(s=>s.active&&s.formId===e.formId);for(let s of n){e.title=e.title||s.name,e.class=e.class||s.class;for(let c of s.components)c.key=c.key?.startsWith("data.")?c.key:"data."+c.key,e.components.push(c)}this.translateForm(e)}),e}modal(t,e=[],n={data:{}},s=g=>{},c={}){return new Promise(g=>{this._modal.show(A(V({},c),{component:$,class:"forms_modal",size:"big",form:t,buttons:Array.isArray(e)?e:[e],submition:n,onClose:function(){g(this.submition)},submit:O=>{g(O)},change:O=>{typeof s=="function"&&s(O)}}))})}modalDocs(t){return new Promise(e=>{let n={docs:JSON.stringify(t.length?t:[],null,4)};this._modal.show({component:$,class:"forms_modal",size:"big",submition:n,form:{title:"Modify content of documents",components:[{name:"Code",key:"docs",fields:[{name:"Placeholder",value:"fill content of documents"}]}]},onClose:function(){let s=n.docs?JSON.parse(n.docs):[];e(s)},submit:()=>{let s=n.docs?JSON.parse(n.docs):[];e(s)}})})}modalUnique(t,e,n,s="",c=()=>{}){this._modal.show({component:st,form:this.getDefaultForm("unique",[e+(s?"."+s:"")]),module:t,field:e,doc:n,class:"forms_modal",onClose:c})}getComponent(t,e){return this._getComponent(t.components,e)||{}}getField(t,e,n){let s=this.getComponent(t,e);if(!s)return null;for(let c of s?.fields||[])if(c.name===n)return c;return null}setValue(t,e,n,s){let c=this.getField(t,e,n);c&&(c.value=s,this.getComponent(t,e)?.resetFields?.())}_getComponent(t,e){for(let n of t){if(n.key===e)return n;if(n.components){let s=this._getComponent(n.components,e);if(s)return s}}return null}_addCustomComponents(t){}};o.\u0275fac=function(e){return new(e||o)},o.\u0275prov=P({token:o,factory:o.\u0275fac,providedIn:"root"});let i=o;return i})();var pt=(i,o,r,t,e,n,s,c)=>({field:i,config:o,component:r,key:t,submition:e,wSubmit:n,wChange:s,wClick:c}),dt=i=>({$implicit:i});function ut(i,o){if(i&1){let r=v();l(0,"form-component",4),_("wSubmit",function(){d(r);let e=a(3);return u(e.wSubmit.emit(e.submition))})("wChange",function(){d(r);let e=a(3);return u(e.wChange.emit())})("wClick",function(){d(r);let e=a(3);return u(e.wClick.emit())}),p()}if(i&2){let r=a(),t=r.$implicit,e=r.$index,n=a(2);x(n.config.formId+"_"+n.index+"_"+e+" "+(n.component.class||"")),f("component",t)("submition",n.submition)("config",n.config)("index",n.index+"_"+e)}}function ft(i,o){if(i&1&&y(0,ut,1,6,"form-component",3),i&2){let r=a(2);F(r.component.hidden?-1:0)}}function _t(i,o){if(i&1&&(l(0,"div",2),k(1,ft,1,1,null,null,S),p()),i&2){let r=a();x(r.component.class||""),h(),I(r.component.components)}}function ht(i,o){i&1&&z(0)}function Ct(i,o){if(i&1&&(l(0,"div",1),J(1,ht,1,0,"ng-container",5),p()),i&2){let r=a();h(),f("ngTemplateOutlet",r.template)("ngTemplateOutletContext",H(11,dt,Y(2,pt,r.field,r.config,r.component,r.localKey,r.localSubmition,r.submit.bind(r),r.change.bind(r),r.click.bind(r))))}}var mt=(()=>{let o=class o{constructor(){this._form=m(ct),this.submition={},this.wSubmit=new w,this.wChange=new w,this.wClick=new w,this.field={}}submit(){this.wSubmit.emit(this.submition)}change(){this.wChange.emit(this.submition)}click(){this.wClick.emit(this.submition)}get hasComponents(){return Array.isArray(this.component.components)}get template(){return this._form.getTemplateComponent(this.component.name)}ngOnInit(){this.component.resetFields=this._resetFields.bind(this),this._resetFields(),this.localSubmition=this.submition;let t=(this.component.key||"")?.split(".");for(;t.length>1;){let e=t.shift();if(e.endsWith("[]")){e=e.replace("[]","");let n=this._getIndex();for(this.localSubmition[e]=this.localSubmition[e]||[];n+1>this.localSubmition[e].length;)this.localSubmition[e].push({});this.localSubmition=this.localSubmition[e][n]}else this.localSubmition=this.localSubmition[e]||{}}this.localKey=t[0]}_getIndex(t=this.config.components){for(let e of t)if(e.components){if(this._getIndex(e.components)>=0){for(let s=0;s<e.components.length;s++)for(let c of e.components[s].components)if(c===this.component)return s}if(e?.components?.indexOf(this.component)>=0)return e.components.indexOf(this.component)}return-1}_resetFields(){if(Array.isArray(this.component.fields))for(let t of this.component.fields)this.field[t.name]=t.value}};o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=C({type:o,selectors:[["form-component"]],inputs:{index:"index",config:"config",component:"component",submition:"submition"},outputs:{wSubmit:"wSubmit",wChange:"wChange",wClick:"wClick"},decls:2,vars:2,consts:[[1,"form-components-container",3,"class"],[1,"form-container"],[1,"form-components-container"],[1,"w-forms__component",3,"class","component","submition","config","index"],[1,"w-forms__component",3,"wSubmit","wChange","wClick","component","submition","config","index"],[4,"ngTemplateOutlet","ngTemplateOutletContext"]],template:function(e,n){e&1&&(y(0,_t,3,2,"div",0),y(1,Ct,2,13,"div",1)),e&2&&(F(n.hasComponents?0:-1),h(),F(n.component.name&&n.template&&(!n.component.key||n.localKey&&n.localSubmition)?1:-1))},dependencies:[o,X],styles:["[_nghost-%COMP%]{position:relative}.w-forms[_ngcontent-%COMP%]{position:relative;padding:0!important;background-color:red}.w-forms__component[_ngcontent-%COMP%]{align-items:end;margin:0 0 10px}.w-forms__level[_ngcontent-%COMP%]{top:3px;right:5px;position:absolute;display:inline-block;color:var(--c-text-secondary);font-size:22px;line-height:calc(var(--fs) + 4px);letter-spacing:var(--letter-spacing);transition:var(--transition)}.w-forms__level._sky[_ngcontent-%COMP%]{color:var(--c-info)}.w-forms__level._orange[_ngcontent-%COMP%]{color:var(--c-warn)}.w-forms__level._green[_ngcontent-%COMP%]{color:var(--c-success)}.w-forms__input[_ngcontent-%COMP%]{padding-right:35px}.w-forms__input-block[_ngcontent-%COMP%]{position:relative}.w-forms__toggle[_ngcontent-%COMP%]{display:flex;position:absolute;right:10px;bottom:10px;color:var(--c-placeholder);transform:translateY(-50%);cursor:pointer}.w-forms__toggle[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:21px}.w-forms[_ngcontent-%COMP%]   .icon-visibility[_ngcontent-%COMP%]{color:var(--c-primary)}"]});let i=o;return i})();function gt(i,o){if(i&1&&(l(0,"h1",1),j(1),p()),i&2){let r=a();h(),L(r.config.title)}}function bt(i,o){if(i&1){let r=v();l(0,"form-component",4),_("wSubmit",function(){d(r);let e=a(2);return u(e.onSubmit())})("wChange",function(){d(r);let e=a(2);return u(e.onChange())})("wClick",function(){d(r);let e=a(2);return u(e.onClick())}),p()}if(i&2){let r=a(),t=r.$implicit,e=r.$index,n=a();x(n.config.formId+"_"+e+" "+(t.class||"")+" "+n.config.formId),f("component",t)("submition",n.submition)("config",n.config)("index",""+e)}}function wt(i,o){if(i&1&&y(0,bt,1,6,"form-component",3),i&2){let r=o.$implicit;F(r.hidden?-1:0)}}var E=(()=>{let o=class o{constructor(){this._core=m(b),this.submition={},this.wChange=new w,this.wSubmit=new w}ngAfterViewInit(){this.submition.data=this.submition.data||{}}component(t,e=this.config.components){for(let n of e){if(n.key===t)return n;if(n.components?.length){let s=this.component(t,n.components);if(s)return s}}return!1}onSubmit(){this._core.afterWhile(this,()=>{for(let t of this.config.components)if(t.key&&t.required&&(t.valid&&!t.valid()||!t.valid&&!this.submition[t.key])){typeof t.focus=="function"&&t.focus();return}this.wSubmit.emit(this.submition)})}onChange(){this._core.afterWhile(this,()=>{this.wChange.emit(this.submition)})}onClick(){}};o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=C({type:o,selectors:[["wform"]],inputs:{config:"config",submition:"submition"},outputs:{wChange:"wChange",wSubmit:"wSubmit"},decls:5,vars:1,consts:[[1,"w-forms"],[1,"w-forms__title"],[3,"ngSubmit"],[1,"w-forms__component",3,"class","component","submition","config","index"],[1,"w-forms__component",3,"wSubmit","wChange","wClick","component","submition","config","index"]],template:function(e,n){e&1&&(l(0,"div",0),y(1,gt,2,1,"h1",1),l(2,"form",2),_("ngSubmit",function(){return n.onSubmit()}),k(3,wt,1,1,null,null,S),p()()),e&2&&(h(),F(n.config.title?1:-1),h(2),I(n.config.components))},dependencies:[mt],encapsulation:2});let i=o;return i})();export{it as a,E as b,rt as c,ct as d};
