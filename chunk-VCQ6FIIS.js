import{a as q}from"./chunk-3XLUGM2L.js";import"./chunk-JRAEII2A.js";import"./chunk-2IXD5A4M.js";import"./chunk-D6KJIOZP.js";import"./chunk-A26GYWKC.js";import"./chunk-SMMVKXXX.js";import{b as m}from"./chunk-K5ATWWWY.js";import{d as A}from"./chunk-CZLGUVAL.js";import"./chunk-2YGQTJPJ.js";import{a as j}from"./chunk-MUJBVTFU.js";import{a as B}from"./chunk-2H4XP5XP.js";import{j as b,k as I,q as d}from"./chunk-6F3JZZEN.js";import{$ as v,A as _,Db as S,Kb as k,Z as n,aa as w,pa as C,sa as y,z as u}from"./chunk-QGRJSNEC.js";var i={formId:"schoolcourse",title:"Schoolcourse",components:[{name:"Photo",key:"thumb",fields:[{name:"Label",value:"Photo"}]},{name:"Text",key:"name",focused:!0,fields:[{name:"Placeholder",value:"fill course title"}]},{name:"Text",key:"description",fields:[{name:"Placeholder",value:"fill course description"},{name:"Label",value:"Description"}]},{name:"Select",key:"requiredCourse",hidden:!0,fields:[{name:"Placeholder",value:"Select required \u0441ourse"},{name:"Label",value:"Required Course"},{name:"Multiple",value:!0},{name:"Items",value:[]}]},{name:"Select",key:"suggestedCourse",hidden:!0,fields:[{name:"Placeholder",value:"Select suggested \u0441ourse"},{name:"Label",value:"Suggested Course"},{name:"Multiple",value:!0},{name:"Items",value:[]}]},{name:"Number",key:"duration",fields:[{name:"Placeholder",value:"set course duration"},{name:"Label",value:"Duration"}]},{name:"Number",key:"cost",fields:[{name:"Placeholder",value:"set course cost"},{name:"Label",value:"Cost"}]},{name:"Tags",key:"learning",fields:[{name:"Button",value:"Add what we are learning"},{name:"Placeholder",value:"fill learnings"},{name:"Label",value:"What student will learn"}]},{name:"Tags",key:"included",fields:[{name:"Button",value:"Add what is included"},{name:"Placeholder",value:"fill included"},{name:"Label",value:"Included"}]},{name:"Tags",key:"requirements",fields:[{name:"Button",value:"Add what is required to know"},{name:"Placeholder",value:"fill requirements"},{name:"Label",value:"Requirements"}]},{name:"Select",key:"status",fields:[{name:"Items",value:["Active","Inactive"]},{name:"Placeholder",value:"choose course status"},{name:"Label",value:"Status"},{name:"Multiple",value:!1}]},{name:"Select",key:"knowledge",hidden:!0,fields:[{name:"Items",value:[]},{name:"Placeholder",value:"choose course knowledge"},{name:"Label",value:"Knowledge"},{name:"Name",value:"title"}]}]};var P=(()=>{let e=class e extends d{constructor(){super({name:"schoolcourse",replace:t=>{t.thumb=t.thumb||"assets/logo.png"}}),this.schoolcourses=this.getDocs(),this.schoolcoursesBySchool={},this.schoolcoursesByAuthor={},this.get(),this.filteredDocuments(this.schoolcoursesBySchool,"school",void 0,(t,s)=>t.order-s.order),this.filteredDocuments(this.schoolcoursesByAuthor,"author",void 0,(t,s)=>t.order-s.order)}};e.\u0275fac=function(s){return new(s||e)},e.\u0275prov=u({token:e,factory:e.\u0275fac,providedIn:"root"});let l=e;return l})();var x=(()=>{let e=class e extends d{constructor(){super({name:"schoolknowledge"}),this.schoolknowledges=this.getDocs(),this.schoolknowledgesBySchool={},this.schoolknowledgesByKnowledge={},this.get(),this.filteredDocuments(this.schoolknowledgesBySchool,"school"),this.filteredDocuments(this.schoolknowledgesByKnowledge,"knowledge")}};e.\u0275fac=function(s){return new(s||e)},e.\u0275prov=u({token:e,factory:e.\u0275fac,providedIn:"root"});let l=e;return l})();var g=(()=>{let e=class e{get hasAccess(){return this._us.role("admin")||this._us.role("schoolowner")||this._us.role("schoolteacher")}get rows(){return this.school?this._schoolcourseService.schoolcoursesBySchool[this.school]:this._schoolcourseService.schoolcoursesByAuthor[this._us.user._id]}constructor(t,s,r,h,f,D,F,L){this._schoolcourseService=t,this._schoolknowledge=s,this._translate=r,this._alert=h,this._form=f,this._core=D,this._router=F,this._us=L,this.columns=["name","duration","cost","status"],this.school=this._router.url.includes("/courses/")?this._router.url.split("/")[this._router.url.split("/").length-1]:"",this.form=this._form.getForm("schoolcourse",i),this.config={create:this.hasAccess?()=>{this.school||(this._form.getComponent(i,"suggestedCourse").hidden=!0,this._form.getComponent(i,"requiredCourse").hidden=!0),this._form.modal(this.form,{label:"Create",click:(o,a)=>{this._preCreate(o),this._schoolcourseService.create(o),a()}})}:null,update:this.hasAccess?o=>{this.school||(o.school?(this._form.getComponent(i,"suggestedCourse").hidden=!1,this._form.setValue(i,"suggestedCourse","Items",this._schoolcourseService.schoolcoursesBySchool[o.school]),this._form.getComponent(i,"requiredCourse").hidden=!1,this._form.setValue(i,"requiredCourse","Items",this._schoolcourseService.schoolcoursesBySchool[o.school])):(this._form.getComponent(i,"suggestedCourse").hidden=!0,this._form.getComponent(i,"requiredCourse").hidden=!0)),this._form.modal(this.form,[],o).then(a=>{this._core.copy(a,o),this._schoolcourseService.update(o)})}:null,delete:this.hasAccess?o=>{this._alert.question({text:this._translate.translate("Common.Are you sure you want to delete this schoolcourse?"),buttons:[{text:this._translate.translate("Common.No")},{text:this._translate.translate("Common.Yes"),callback:()=>{this._schoolcourseService.delete(o)}}]})}:null,buttons:[this.hasAccess?{icon:"arrow_upward",click:o=>{let a=this.rows.findIndex(c=>c._id===o._id);a&&(this.rows.splice(a,1),this.rows.splice(a-1,0,o));for(let c=0;c<this.rows.length;c++)this.rows[c].order!==c&&(this.rows[c].order=c,this._schoolcourseService.update(this.rows[c]))}}:null,this.hasAccess?{icon:"cloud_download",click:o=>{this._form.modalUnique("schoolcourse","url",o)}}:null,{icon:"event",hrefFunc:o=>this._roleUrl()+"sessions/"+o._id},{icon:"work",hrefFunc:o=>this._roleUrl()+"lessons/"+o._id},{icon:"assignment",hrefFunc:o=>this._roleUrl()+"tests/course/"+o._id},{icon:"card_membership",hrefFunc:o=>this._roleUrl()+"certificates/course/"+o._id}],headerButtons:[this.hasAccess?{icon:"playlist_add",click:this._bulkManagement(),class:"playlist"}:null,this.hasAccess?{icon:"edit_note",click:this._bulkManagement(!1),class:"edit"}:null]},this.onKnowledge=this._core.on("schoolknowledge_get").subscribe(()=>{this.school&&(i.components[5].hidden=!1,i.components[5].fields[0].value.push(...this._schoolknowledge.schoolknowledgesBySchool[this.school]))}),this._core.onComplete("schoolcourse_loaded").then(()=>{this.school&&(this._form.getComponent(i,"suggestedCourse").hidden=!1,this._form.setValue(i,"suggestedCourse","Items",this._schoolcourseService.schoolcoursesBySchool[this.school]),this._form.getComponent(i,"requiredCourse").hidden=!1,this._form.setValue(i,"requiredCourse","Items",this._schoolcourseService.schoolcoursesBySchool[this.school]))})}ngOnDestroy(){this.onKnowledge.unsubscribe()}_bulkManagement(t=!0){return()=>{this._form.modalDocs(t?[]:this.rows).then(s=>{if(t)for(let r of s)this._preCreate(r),this._schoolcourseService.create(r);else{for(let r of this.rows)s.find(h=>h._id===r._id)||this._schoolcourseService.delete(r);for(let r of s){let h=this.rows.find(f=>f._id===r._id);h?(this._core.copy(r,h),this._schoolcourseService.update(h)):(this._preCreate(r),this._schoolcourseService.create(r))}}})}}_preCreate(t){delete t.__created,this.school&&(t.school=this.school)}_roleUrl(){return this._us.role("admin")?"/admin/":this._us.role("schoolowner")?"/owner/":this._us.role("schoolteacher")?"/teacher/":"/"}};e.\u0275fac=function(s){return new(s||e)(n(P),n(x),n(B),n(b),n(A),n(I),n(S),n(j))},e.\u0275cmp=v({type:e,selectors:[["ng-component"]],standalone:!1,decls:1,vars:3,consts:[["title","Courses",3,"columns","config","rows"]],template:function(s,r){s&1&&y(0,"wtable",0),s&2&&C("columns",r.columns)("config",r.config)("rows",r.rows)},dependencies:[m],encapsulation:2});let l=e;return l})();var U=[{path:"",component:g},{path:":schoolcourse",component:g}],$=(()=>{let e=class e{};e.\u0275fac=function(s){return new(s||e)},e.\u0275mod=w({type:e}),e.\u0275inj=_({imports:[k.forChild(U),q,m]});let l=e;return l})();export{$ as CoursesModule};
