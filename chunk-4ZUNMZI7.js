import{a as W}from"./chunk-3XLUGM2L.js";import"./chunk-JRAEII2A.js";import"./chunk-2IXD5A4M.js";import"./chunk-D6KJIOZP.js";import"./chunk-A26GYWKC.js";import"./chunk-SMMVKXXX.js";import{b as g}from"./chunk-K5ATWWWY.js";import{a as R,b as O,d as C}from"./chunk-CZLGUVAL.js";import"./chunk-2YGQTJPJ.js";import{a as H}from"./chunk-MUJBVTFU.js";import{a as U}from"./chunk-2H4XP5XP.js";import{j as B,k as y,p as V,q as N,s as E}from"./chunk-6F3JZZEN.js";import{$ as v,A as S,Db as D,F as f,G as _,Ja as w,Kb as M,U as F,Z as r,a as b,aa as j,ea as I,jb as L,kb as P,pa as m,qa as u,ra as h,sa as Q,wa as k,xa as d,ya as a,z as q}from"./chunk-QGRJSNEC.js";function ee(i,s){if(i&1){let c=k();u(0,"wform",3),d("wChange",function(){f(c);let t=a(2);return _(t.change())}),h()}if(i&2){let c=a().$implicit,e=a();m("submition",c)("config",e.form)}}function te(i,s){if(i&1){let c=k();u(0,"div")(1,"wbutton",1),d("click",function(){let t=f(c).index,o=a();return o.questionIndex=t,_(o.change())}),w(2,"Edit question"),h(),I(3,ee,1,2,"wform",2),u(4,"wbutton",1),d("click",function(){let t=f(c).index,o=a();return o.test.questions.splice(t,1),_(o.update())}),w(5,"Remove question"),h()()}if(i&2){let c=s.index,e=a();F(3),m("ngIf",e.questionIndex===c)}}var Y=(()=>{let s=class s{get questions(){return this.test.questions}constructor(e,t,o){this._form=e,this._core=t,this._http=o,this.questionIndex=0,this.form=this._form.getForm("testQuestions",{formId:"testQuestions",title:"Question",components:[{name:"Text",key:"question",focused:!0,fields:[{name:"Placeholder",value:"fill questions text"},{name:"Label",value:"Text"}]},{name:"Select",key:"type",fields:[{name:"Placeholder",value:"select questions type"},{name:"Label",value:"Type"},{name:"Items",value:["Text","Radio","Checkbox","ArrayTexts","TwoArrayConnects"]}]},{name:"Tags",key:"answers",hidden:!0,fields:[{name:"Button",value:"Add answers"},{name:"Placeholder",value:"fill questions answers"},{name:"Label",value:"Answers"}]},{name:"Tags",key:"connectTo",hidden:!0,fields:[{name:"Button",value:"Add connectTo"},{name:"Placeholder",value:"fill questions connections"},{name:"Label",value:"ConnectTo"}]},{name:"Text",key:"text",hidden:!0,fields:[{name:"Placeholder",value:"fill answer text"},{name:"Label",value:"Answer"}]},{name:"Text",key:"radio",hidden:!0,fields:[{name:"Button",value:"Add correct answer"},{name:"Placeholder",value:"fill correct answer"},{name:"Label",value:"Correct Answer"}]},{name:"Tags",key:"checkboxes",hidden:!0,fields:[{name:"Button",value:"Add correct answers"},{name:"Placeholder",value:"fill correct answers"},{name:"Label",value:"Correct Answers"}]},{name:"Tags",key:"arrayTexts",hidden:!0,fields:[{name:"Button",value:"Add correct answers"},{name:"Placeholder",value:"fill correct answers"},{name:"Label",value:"Correct Answers"}]},{name:"Tags",key:"twoArrayConnects",hidden:!0,fields:[{name:"Button",value:"Add correct answers"},{name:"Placeholder",value:"fill correct answers"},{name:"Label",value:"Correct Answers"}]}]})}ngOnInit(){this.change(),this._http.post("/api/school/test/get",this.test,e=>{if(e)for(let t=0;t<this.test.questions.length;t++)this.test.questions[t]=b(b({},this.test.questions[t]),e.answers[t])})}change(){let e=this.questions[this.questionIndex];this.form.components[2].hidden=!e.type||e.type==="Text",this.form.components[3].hidden=e.type!=="TwoArrayConnects",this.form.components[4].hidden=e.type!=="Text",this.form.components[5].hidden=e.type!=="Radio",this.form.components[6].hidden=e.type!=="Checkbox",this.form.components[7].hidden=e.type!=="ArrayTexts",this.form.components[8].hidden=e.type!=="TwoArrayConnects",this.updateAfterWhile()}addQuestion(){this.test.questions.push({}),this.change()}update(){this._http.post("/api/school/test/update",this.test)}updateAfterWhile(){this._core.afterWhile("question",this.update.bind(this),2e3)}};s.\u0275fac=function(t){return new(t||s)(r(C),r(y),r(V))},s.\u0275cmp=v({type:s,selectors:[["app-test-questions"]],standalone:!1,decls:3,vars:1,consts:[[4,"ngFor","ngForOf"],[3,"click"],[3,"submition","config","wChange",4,"ngIf"],[3,"wChange","submition","config"]],template:function(t,o){t&1&&(I(0,te,6,1,"div",0),u(1,"wbutton",1),d("click",function(){return o.addQuestion()}),w(2,"Add question"),h()),t&2&&m("ngForOf",o.questions)},dependencies:[L,P,O,R],encapsulation:2});let i=s;return i})();var $={formId:"schooltest",title:"Schooltest",components:[{name:"Text",key:"name",focused:!0,fields:[{name:"Placeholder",value:"fill tests title"},{name:"Label",value:"Title"}]},{name:"Text",key:"description",fields:[{name:"Placeholder",value:"fill tests description"},{name:"Label",value:"Description"}]},{name:"Number",key:"duration",fields:[{name:"Placeholder",value:"set tests duration"},{name:"Label",value:"Duration"}]}]};var z=(()=>{let s=class s extends N{constructor(){super({name:"schooltest"}),this.schooltests=this.getDocs(),this.byId={school:{},course:{},lesson:{}},this.get(),this.filteredDocuments(this.byId.school,"school"),this.filteredDocuments(this.byId.course,"course"),this.filteredDocuments(this.byId.lesson,"lesson")}};s.\u0275fac=function(t){return new(t||s)},s.\u0275prov=q({token:s,factory:s.\u0275fac,providedIn:"root"});let i=s;return i})();var p=(()=>{let s=class s{get hasAccess(){return this._us.role("admin")||this._us.role("schoolowner")||this._us.role("schoolteacher")}get rows(){return this.moduleType?this._schooltestService.byId[this.moduleType][this.moduleId]:this._schooltestService.schooltests}constructor(e,t,o,l,x,G,J,K){this._translate=e,this._schooltestService=t,this._alert=o,this._form=l,this._core=x,this._router=G,this._modal=J,this._us=K,this.columns=["_id","title","duration"],this.moduleType=this._router.url.includes("/tests/")?this._router.url.split("/")[this._router.url.split("/").length-2]:"",this.moduleId=this._router.url.includes("/tests/")?this._router.url.split("/")[this._router.url.split("/").length-1]:"",this.form=this._form.getForm("schooltest",$),this.config={create:this.hasAccess?()=>{this._form.modal(this.form,{label:"Create",click:(n,T)=>{this._preCreate(n),this._schooltestService.create(n),T()}})}:null,update:this.hasAccess?n=>{this._form.modal(this.form,[],n).then(T=>{this._core.copy(T,n),this._schooltestService.update(n)})}:null,delete:this.hasAccess?n=>{this._alert.question({text:this._translate.translate("Common.Are you sure you want to delete this schooltest?"),buttons:[{text:this._translate.translate("Common.No")},{text:this._translate.translate("Common.Yes"),callback:()=>{this._schooltestService.delete(n)}}]})}:null,buttons:[this.hasAccess?{icon:"assignment_turned_in",click:n=>{n.questions=n.questions||[],this._modal.show({component:Y,test:n})}}:null,this.hasAccess?{icon:"cloud_download",click:n=>{this._form.modalUnique("tests","url",n)}}:null,{icon:"card_membership",hrefFunc:n=>this._roleUrl()+"certificates/test/"+n._id}],headerButtons:[this.hasAccess?{icon:"playlist_add",click:this._bulkManagement(),class:"playlist"}:null,this.hasAccess?{icon:"edit_note",click:this._bulkManagement(!1),class:"edit"}:null]}}_bulkManagement(e=!0){return()=>{this._form.modalDocs(e?[]:this.rows).then(t=>{if(e)for(let o of t)this._preCreate(o),this._schooltestService.create(o);else{for(let o of this.rows)t.find(l=>l._id===o._id)||this._schooltestService.delete(o);for(let o of t){let l=this.rows.find(x=>x._id===o._id);l?(this._core.copy(o,l),this._schooltestService.update(l)):(this._preCreate(o),this._schooltestService.create(o))}}})}}_preCreate(e){switch(delete e.__created,this.moduleType){case"course":e.course=this.moduleId;break;case"lesson":e.lesson=this.moduleId;break;case"school":e.school=this.moduleId;break}}_roleUrl(){return this._us.role("admin")?"/admin/":this._us.role("schoolowner")?"/owner/":this._us.role("schoolteacher")?"/teacher/":"/"}};s.\u0275fac=function(t){return new(t||s)(r(U),r(z),r(B),r(C),r(y),r(D),r(E),r(H))},s.\u0275cmp=v({type:s,selectors:[["ng-component"]],standalone:!1,decls:1,vars:3,consts:[["title","Tests",3,"columns","config","rows"]],template:function(t,o){t&1&&Q(0,"wtable",0),t&2&&m("columns",o.columns)("config",o.config)("rows",o.rows)},dependencies:[g],encapsulation:2});let i=s;return i})();var oe=[{path:"",component:p},{path:"school/:schooltest",component:p},{path:"course/:schooltest",component:p},{path:"lesson/:schooltest",component:p}],qe=(()=>{let s=class s{};s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=j({type:s}),s.\u0275inj=S({imports:[M.forChild(oe),W,g]});let i=s;return i})();export{qe as TestsModule};
